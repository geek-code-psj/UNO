<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="UNO Arena Leaderboard â€” See the top players ranked by wins, win rate, and games played.">
    <title>Leaderboard â€” UNO Arena</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>

    <nav class="nav">
        <a class="nav-brand" href="/">
            <div class="logo-icon">ğŸ‚¡</div>
            UNO Arena
        </a>
        <ul class="nav-links">
            <li><a href="/">ğŸ® Lobby</a></li>
            <li><a href="/offline.html">ğŸ¤– Offline</a></li>
            <li><a href="/rules.html">ğŸ“– Rules</a></li>
            <li><a href="/leaderboard.html" class="active">ğŸ† Leaderboard</a></li>
            <li><a href="/shop.html">ğŸ›’ Shop</a></li>
            <li><a href="/tournament.html">âš”ï¸ Tournaments</a></li>
        </ul>
        <div class="nav-user">
            <div class="coins"><span>ğŸª™</span> <span id="coin-count">0</span></div>
        </div>
    </nav>

    <div class="page-container">
        <div class="page-header">
            <h1>ğŸ† Leaderboard</h1>
            <p>Top players ranked by performance</p>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="loadLeaderboard('wins', this)">ğŸ… Most Wins</button>
            <button class="tab-btn" onclick="loadLeaderboard('winrate', this)">ğŸ“ˆ Win Rate</button>
            <button class="tab-btn" onclick="loadLeaderboard('games', this)">ğŸ® Most Games</button>
        </div>

        <div class="panel">
            <table class="leaderboard-table" id="leaderboard-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Wins</th>
                        <th>Losses</th>
                        <th>Games</th>
                        <th>Win Rate</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <tr>
                        <td colspan="6" style="text-align:center;padding:40px;color:var(--text-muted)">Loading...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        async function loadLeaderboard(sortBy = 'wins', btn) {
            // Update active tab
            if (btn) {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }

            try {
                const res = await fetch(`/api/leaderboard?sort=${sortBy}`);
                const data = await res.json();
                renderLeaderboard(data.leaderboard);
            } catch (err) {
                console.error('Failed to load leaderboard:', err);
            }
        }

        function renderLeaderboard(players) {
            const body = document.getElementById('leaderboard-body');

            if (!players || players.length === 0) {
                body.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:var(--text-muted)">No players yet. Play some games!</td></tr>';
                return;
            }

            body.innerHTML = players.map((p, i) => {
                const rank = i + 1;
                let rankClass = '';
                let badgeClass = '';
                if (rank === 1) { rankClass = 'rank-1'; badgeClass = 'gold'; }
                else if (rank === 2) { rankClass = 'rank-2'; badgeClass = 'silver'; }
                else if (rank === 3) { rankClass = 'rank-3'; badgeClass = 'bronze'; }

                const medal = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : rank;

                return `<tr class="${rankClass}">
          <td><span class="rank-badge ${badgeClass}">${medal}</span></td>
          <td style="font-weight:600">${p.username}</td>
          <td>${p.wins}</td>
          <td>${p.losses}</td>
          <td>${p.games_played}</td>
          <td>${p.win_rate}%</td>
        </tr>`;
            }).join('');
        }

        // Load coins from storage
        const token = localStorage.getItem('uno_token');
        if (token) {
            fetch('/api/auth/profile', { headers: { Authorization: `Bearer ${token}` } })
                .then(r => r.json())
                .then(d => { if (d.user) document.getElementById('coin-count').textContent = d.user.coins; })
                .catch(() => { });
        }

        loadLeaderboard('wins');
    </script>
</body>

</html>